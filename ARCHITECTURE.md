# ğŸ—ï¸ Arquitectura TÃ©cnica - FashionMarket

## VisiÃ³n General del Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLIENTE (NAVEGADOR)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              ASTRO 5.0 (Hybrid SSG + SSR)               â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚          PÃGINAS ESTÃTICAS (SSG)               â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ CatÃ¡logo de productos                        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Fichas de producto individuales              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Filtrado por categorÃ­a                       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Homepage                                     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â†’ Pre-renderizadas en build time               â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â†’ Servidas como HTML estÃ¡tico (âš¡ rÃ¡pido)      â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚      PÃGINAS DINÃMICAS (SSR)                   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Panel de Admin (/admin)                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ PÃ¡gina de Carrito                            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Login Admin                                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â†’ Renderizadas en el servidor                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â†’ Acceso protegido vÃ­a auth                    â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚   ISLAS INTERACTIVAS (React Islands)           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ AddToCartButton.tsx                          â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ CartIcon.tsx                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ CartSlideOver.tsx                            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â†’ HidrataciÃ³n selectiva (Solo lo necesario)    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â†’ Estado manejado con Nano Stores              â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚   ESTADO PERSISTENTE (Nano Stores)              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ cartStore                                    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â†’ localStorage (cliente)                       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â†’ SincronizaciÃ³n automÃ¡tica                    â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚    ESTILOS (Tailwind CSS)                       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Paleta custom (navy, charcoal, cream, gold)  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ TipografÃ­as (Playfair Display, Inter)        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Componentes reutilizables                    â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    HTTP/HTTPS Requests
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EDGE / SERVIDOR                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              SUPABASE (Backend Unificado)              â”‚    â”‚
â”‚  â”‚                                                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚     PostgreSQL Database (Datos)                 â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  categories    â”‚   â”‚   products           â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ id (UUID)  â”‚   â”‚   â”œâ”€ id (UUID)       â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ name       â”‚   â”‚   â”œâ”€ name            â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ slug       â”‚   â”‚   â”œâ”€ slug            â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€ desc       â”‚   â”‚   â”œâ”€ price (cents)   â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                â”‚   â”‚   â”œâ”€ stock           â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”œâ”€ category_id (FK)   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                       â”‚   â”œâ”€ images (URL[])   â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”œâ”€ sku              â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  admin_users   â”‚   â”‚   â”œâ”€ material         â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ id (FK)    â”‚   â”‚   â””â”€ status          â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ email      â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ role       â”‚                             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€ is_active  â”‚   Ãndices (Performance):    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â€¢ idx_products_slug      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                       â€¢ idx_products_category  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  Triggers (Auto):     â€¢ idx_products_status    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ update_updated_at  â€¢ idx_products_created_atâ”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚   Row Level Security (RLS Policies)              â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  PRODUCTOS:                                      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ PÃºblico: Solo lectura productos activos      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ Admins: Lectura/escritura todos             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ INSERT/UPDATE/DELETE: Solo autenticados      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  CATEGORÃAS:                                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ PÃºblico: Lectura                             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ Admins: Escritura                            â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  ADMIN_USERS:                                    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ Self: Solo actualizar perfil propio          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ Insert/Delete: Deshabilitado (servidor)      â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚   Authentication (Supabase Auth)                 â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Magic Links / Email/Password                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ JWT Tokens (seguros)                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ SesiÃ³n persistente                            â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ IntegraciÃ³n con admin_users                   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚   Storage (Supabase Storage)                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  Bucket: "products-images"                       â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ PÃºblico: Lectura (descarga)                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ Admins: Subida (POST)                        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ Admins: EliminaciÃ³n (DELETE)                 â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  URLs pÃºblicas:                                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  https://.../storage/v1/object/public/...        â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Flujo de Datos

### 1. OperaciÃ³n: Visualizar CatÃ¡logo (SSG - Build Time)

```
Build Time:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  npm run â”‚
â”‚  build   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Astro: /pages/productos/index.astro â”‚
â”‚ (SSG - ejecuta en build)            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ supabase.from('products')    â”‚
â”‚ .select('*')                 â”‚
â”‚ .eq('status', 'active')      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL (supabase)        â”‚
â”‚ â†“ Ejecuta query RLS          â”‚
â”‚ â†“ Aplica RLS policies        â”‚
â”‚ Devuelve: [productos...]     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Astro: Generate HTML         â”‚
â”‚ ProductCard.astro Ã— N        â”‚
â”‚ (Componentes estÃ¡ticos)      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /dist/productos/index.html   â”‚
â”‚ (HTML pre-renderizado)       â”‚
â”‚ (Servido estÃ¡ticamente ğŸš€)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Runtime (Navegador):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /productos â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Servidor: Lee archivo HTML  â”‚
â”‚ (instantÃ¡neo desde disk)    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Navegador: Renderiza HTML   â”‚
â”‚ + Hidrata React Islands     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. OperaciÃ³n: AÃ±adir al Carrito (Client-Side + Nano Store)

```
Navegador:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AddToCartButton.tsx      â”‚
â”‚ Usuario: Click +Agregar  â”‚
â”‚ Selecciona: Talla + Qty  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FunciÃ³n: addToCart(product, qty) â”‚
â”‚ (lib/stores/cart.ts)             â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nano Store: cartStore.set()      â”‚
â”‚ Actualiza estado en memoria      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ cartStore.subscribe()            â”‚
â”‚ Trigger: Guardar en localStorage â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ localStorage                     â”‚
â”‚ Key: "fashionmarket-cart"        â”‚
â”‚ Valor: JSON serializado          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Persistencia automÃ¡tica:
â€¢ Cierra navegador â†’ Datos persisten
â€¢ Abre de nuevo â†’ Carrito se restaura
â€¢ Sin servidor necesario ğŸ’¾
```

### 3. OperaciÃ³n: Panel Admin (SSR + Protegido)

```
Navegador:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /admin/productos     â”‚
â”‚ (usuario no autenticado) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Astro: Middleware.ts             â”‚
â”‚ Verifica: user en contexto       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
     â”‚ Â¿Usuario no autenticado?  â”‚
     â†“                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ Redirige a /admin/login  â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                                 â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ Â¿Usuario autenticado?
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SSR: Renderiza en servidor       â”‚
â”‚ /pages/admin/productos/index.astro
â”‚ Ejecuta cÃ³digo Astro en servidor â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ supabase.from('products')        â”‚
â”‚ .select('*')                     â”‚
â”‚ (RLS: usuario es admin â†’ acceso) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Genera HTML en servidor          â”‚
â”‚ EnvÃ­a al navegador               â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Navegador: Renderiza tabla       â”‚
â”‚ Admin puede: Edit/Delete/Create  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. OperaciÃ³n: Subir Imagen (Drag & Drop)

```
Navegador:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Formulario: /admin/productos/nuevo
â”‚ Usuario: Arrastra imagen         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FileInput: Acepta archivos       â”‚
â”‚ Valida: tipo, tamaÃ±o             â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
     â”‚                           â”‚
     â”‚ Â¿Archivo vÃ¡lido?          â”‚
     â†“                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Procesa archivo                  â”‚
â”‚ Prepara FormData                 â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Â¿VÃ¡lido?
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                            â”‚
     â†“                            â†“
Supabase Storage          localStorage
                          (fallback)
â”‚
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ supabase.storage                         â”‚
â”‚ .from('products-images')                 â”‚
â”‚ .upload(filename, file)                  â”‚
â”‚ (RLS: user es admin â†’ permitido)         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
     â”‚                                   â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â†“                                   â†“
  Ã‰xito                               Error
  â”‚                                   â”‚
  â†“                                   â†“
ObtÃ©n URL pÃºblica              Muestra alerta
â”‚                              â”‚
â†“                              â†“
Guarda URL en form             Usuario reintenta
â”‚
â†“
EnvÃ­a producto con URLs
â”‚
â†“
PostgreSQL INSERT
â”‚
â†“
âœ“ Producto creado
```

## Tablas de DecisiÃ³n: SSG vs SSR

| CaracterÃ­stica | SSG (Static) | SSR (Server) |
|---|---|---|
| **CuÃ¡ndo** | Contenido pÃºblico, frecuencia de cambio baja | Contenido dinÃ¡mico, requiere autenticaciÃ³n |
| **Rendimiento** | âš¡âš¡âš¡ Muy rÃ¡pido (archivos estÃ¡ticos) | âš¡âš¡ RÃ¡pido (server rendering) |
| **SEO** | âœ… Perfecto (HTML completo) | âœ… Bueno (HTML dinÃ¡mico) |
| **Ejemplos** | CatÃ¡logo, fichas producto, homepage | Admin, carrito personalizado, checkout |
| **CachÃ©** | HTTP cache headers (meses) | Cache headers cortos o sin cache |
| **Interactividad** | VÃ­a React Islands | VÃ­a React Islands + Server Actions |

## Seguridad: RLS (Row Level Security)

### Productos - Lectura PÃºblica

```sql
CREATE POLICY "Products: Public read active"
  ON products
  FOR SELECT
  USING (status = 'active');
  
-- Resultado:
SELECT * FROM products 
WHERE status = 'active' 
-- âœ… Usuario anÃ³nimo: ve productos activos
-- âŒ Usuario anÃ³nimo: NO ve productos archived
```

### Productos - Escritura Restringida

```sql
CREATE POLICY "Products: Admin insert"
  ON products
  FOR INSERT
  WITH CHECK (
    EXISTS (
      SELECT 1 FROM admin_users
      WHERE admin_users.id = auth.uid()
      AND admin_users.is_active = true
    )
  );

-- Resultado:
INSERT INTO products (name, price, stock, ...)
-- âœ… Admin logueado: INSERT exitoso
-- âŒ Usuario anÃ³nimo: Access Denied
-- âŒ Usuario normal: Access Denied
```

### Storage - Acceso Granular

```sql
CREATE POLICY "Admin upload access"
  ON storage.objects
  FOR INSERT
  WITH CHECK (
    bucket_id = 'products-images'
    AND EXISTS (
      SELECT 1 FROM admin_users
      WHERE admin_users.id = auth.uid()
      AND admin_users.is_active = true
    )
  );

-- Resultado:
-- âœ… Admin sube imagen â†’ Se almacena en products-images/
-- âœ… PÃºblico descarga imagen â†’ Acceso vÃ­a URL pÃºblica
-- âŒ Usuario normal intenta subir â†’ Access Denied
```

## Rendimiento: Estrategia de CachÃ©

### Nivel 1: Build-Time Static (SSG)

```
CatÃ¡logo: /productos
â”œâ”€ Generado una vez en build
â”œâ”€ Servido desde CDN
â”œâ”€ Cache-Control: public, max-age=31536000
â””â”€ Revalidation: On-demand deploy

Ficha de Producto: /productos/[slug]
â”œâ”€ Generado dinÃ¡micamente en build
â”œâ”€ Una pÃ¡gina HTML por producto
â”œâ”€ Cache-Control: public, max-age=86400
â””â”€ Si cambias stock â†’ redeploy
```

### Nivel 2: Browser Cache

```
Navegador:
â”œâ”€ localStorage: Carrito (indefinido)
â”œâ”€ sessionStorage: BÃºsquedas temporales
â””â”€ HTTP Cache: ImÃ¡genes, assets estÃ¡ticos
```

### Nivel 3: Database Query Optimization

```sql
-- âœ… RÃ¡pido (Ã­ndice)
SELECT * FROM products WHERE slug = 'camisa-oxford'
-- Usa: idx_products_slug

-- âœ… RÃ¡pido (Ã­ndice)
SELECT * FROM products WHERE category_id = 'uuid'
-- Usa: idx_products_category

-- âŒ Lento (sin Ã­ndice)
SELECT * FROM products WHERE material = 'algodÃ³n'
-- RecomendaciÃ³n: agregar Ã­ndice
CREATE INDEX idx_products_material ON products(material);
```

## Flujo Completo: Compra

```
1. DISCOVERY (SSG)
   â””â”€ Usuario: Browse catÃ¡logo
   â””â”€ Sitio: Sirve HTML estÃ¡tico
   â””â”€ âš¡ RÃ¡pido, sin hits a base de datos

2. SELECTION (Client + Nano Store)
   â””â”€ Usuario: Selecciona productos
   â””â”€ Sitio: Guarda en cartStore + localStorage
   â””â”€ ğŸ’¾ Persistencia automÃ¡tica

3. CHECKOUT (SSR)
   â””â”€ Usuario: Accede a /checkout
   â””â”€ Sitio: Valida productos en servidor
   â””â”€ Conecta con Stripe (Fase 2)

4. ORDER (Server)
   â””â”€ Stripe webhook confirm payment
   â””â”€ Crea registro en tabla "orders"
   â””â”€ EnvÃ­a email transaccional
   â””â”€ Actualiza stock en PostgreSQL
```

## Despliegue Recomendado

```
Option 1: Vercel (Recomendado para Astro)
â”œâ”€ Build: AutomÃ¡tico en cada commit
â”œâ”€ SSG: Pre-renderizado y CDN global
â”œâ”€ SSR: Edge Functions
â”œâ”€ Variables de entorno: AutomÃ¡ticas
â””â”€ Costo: Free tier generoso

Option 2: Netlify
â”œâ”€ Build: Similar a Vercel
â”œâ”€ SSG: Pre-renderizado y CDN
â”œâ”€ SSR: Netlify Functions
â””â”€ Costo: Free tier

Option 3: Self-hosted (Node.js)
â”œâ”€ Build: npm run build
â”œâ”€ Deploy: Docker container
â”œâ”€ SSG: Servido como static files
â”œâ”€ SSR: Express/Node.js server
â””â”€ Costo: VPS ($5-20/mes)
```

---

**Arquitectura diseÃ±ada para mÃ¡xima velocidad, seguridad y escalabilidad.** âœ¨
